<!DOCTYPE html>
<html lang="nl">
  <head>
    <title>Botanical Monuments — IABR 2024 - Nature of Hope</title>
    <meta
      name="description"
      content="Botanical Monuments — IABR 2024 - Nature of Hope"
    />

    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
      integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w=="
      crossorigin="anonymous"
    />
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"
      rel="stylesheet"
    />

    <script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
    <script type="text/javascript" src="js/togeojson.js"></script>
    <script type="text/javascript" src="js/settings.js"></script>
    <script type="text/javascript" src="js/stateMachine.js"></script>
    <script type="text/javascript" src="js/utils.js"></script>
    <script type="text/javascript" src="js/patterns.js"></script>
    <script type="text/javascript" src="js/place.js"></script>
    <script type="text/javascript" src="js/marker.js"></script>
    <script type="text/javascript" src="js/area.js"></script>
    <script type="text/javascript" src="js/line.js"></script>
    <script type="text/javascript" src="js/galleryItem.js"></script>
    <script type="text/javascript" src="js/filter.js"></script>

    <link href="style.css" rel="stylesheet" />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https://cdn.glitch.com/35c0f702-4b7f-4512-89ca-8f32ca8189c1%2Fapple-touch-icon.png?v=1615280287521"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://cdn.glitch.com/35c0f702-4b7f-4512-89ca-8f32ca8189c1%2Ffavicon-32x32.png?v=1615280287563"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://cdn.glitch.com/35c0f702-4b7f-4512-89ca-8f32ca8189c1%2Ffavicon-16x16.png?v=1615280287161"
    />
    <link
      rel="manifest"
      href="https://cdn.glitch.com/35c0f702-4b7f-4512-89ca-8f32ca8189c1%2Fsite.webmanifest?v=1615280287438"
    />
    <meta name="msapplication-TileColor" content="#003429" />
    <meta name="theme-color" content="#003429" />
  </head>
  <body data-state="list" data-panel="down">
    <div id="map">
      <form id="filter"></form>
    </div>
    <div id="panel">
      <div id="topbar">
        <div id="title">Botanical Monuments</div>
        <div id="close" class="arrow">
          <svg
            width="24"
            height="24"
            viewbox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M20 11H7.83L13.42 5.41L12 4L4 12L12 20L13.41 18.59L7.83 13H20V11Z"
              fill="#000000"
            />
          </svg>
        </div>
        <div id="toggle">
          <div class="toggle-up arrow">
            <svg
              width="24"
              height="24"
              viewbox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M4 12L5.41 13.41L11 7.83V20H13V7.83L18.58 13.42L20 12L12 4L4 12Z"
                fill="#000000"
              />
            </svg>
          </div>
          <div class="toggle-down arrow">
            <svg
              width="24"
              height="24"
              viewbox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M20 12L18.59 10.59L13 16.17V4H11V16.17L5.42 10.58L4 12L12 20L20 12Z"
                fill="#000000"
              />
            </svg>
          </div>
        </div>
        <div id="menu-toggle">☰</div>
      </div>
      <div id="info"></div>
      <div id="list"></div>
      <div id="menu">
        <div id="about">
          <h2>Botanical Monuments</h2>
          Botanical Monuments — IABR 2024 - Nature of Hope
        </div>
      </div>
    </div>

    <script>
      if (location.protocol != "https:") {
        location.href =
          "https:" +
          window.location.href.substring(window.location.protocol.length);
      }
    </script>
    <script type="text/javascript">
      mapboxgl.accessToken = MAPBOX_API_KEY;

      // let locations = {};
      let map = null;
      let stateMachine = new StateMachine();

      let body = document.body;
      
      //const stateUpdate = new Event("stateUpdate");
      const navigationUpdate = new Event("navigationUpdate");
      const filterUpdate = new Event("filterUpdate");

      let gallery = document.getElementById("list");
      let infopanel = document.getElementById("info");
      let filter = document.getElementById("filter");
      let filterController = new Filter(filter);

      /*************************************
      Follywood Magic!
      **************************************/
      fetch(GMAP_URL)
        //get the Google Maps KML
        .then((response) => response.text())
        //convert KML into JSON
        .then(utils.createGeoJSON)
        //initiate map
        .then(drawMap)
        //convert every location in a place
        .then(createPlaces)
        //load all images
        .then(utils.BackgroundLazyLoader)
        .then(initStateMachine)
        .catch(showError);


      async function drawMap(locations) {
        map = new mapboxgl.Map({
          container: "map",
          style: MAPBOX_STYLE,
          center: MAPBOX_CENTER,
          zoom: MAPBOX_DEFAULT_ZOOM,
        });

        map.setMaxPitch(0);
        map.setMinPitch(0);
        
        await new Promise((resolve, reject) => {
          map.on("load", () => {
            resolve(); // Resolve the Promise with the map object when it's loaded
          });
        });
        
        return locations;
      }

      async function createPlaces(locations) {
        locations.forEach((location) => {
          let place = new Place(location, map, gallery, infopanel);
        });
      }
      
      async function initStateMachine(){
        await stateMachine.init();
        return;
      }

      function showError(e) {
        console.log(e);
      }
      /*************************************
      End Follywood Magic
      **************************************/

      let prevZoom = undefined;
      let prevCenter = undefined;

      let panel = document.getElementById("panel");
      let toggle = document.getElementById("toggle");
      let close = document.getElementById("close");

      let menuToggle = document.getElementById("menu-toggle");

      toggle.addEventListener("click", (e) => {
        togglePanel();
      });

      close.addEventListener("click", (e) => {
        stateMachine.navigateTo(STATES.LIST);
      });

      menuToggle.addEventListener("click", (e) => {
        stateMachine.navigateTo(STATES.MENU);
        togglePanel("up");
      });

      document.documentElement.style.setProperty("--color", COLOR_FRONT);
      document.documentElement.style.setProperty("--bg-color", COLOR_BG);
      document.documentElement.style.setProperty(
        "--highlight-color",
        COLOR_HIGHLIGHT
      );
      document
        .querySelector('meta[name="msapplication-TileColor"]')
        .setAttribute("content", COLOR_BG);
      document
        .querySelector('meta[name="theme-color"]')
        .setAttribute("content", COLOR_BG);
      document.querySelectorAll("path").forEach((el) => {
        el.setAttribute("style", "fill:" + COLOR_FRONT);
      });

      document.getElementById("title").innerHTML = TITLE;
    </script>
  </body>
</html>
